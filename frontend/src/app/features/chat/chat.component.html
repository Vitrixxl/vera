<div class="flex flex-col h-screen bg-[#F5ECDE] font-sans text-[#000000]">
      
  <header class="flex-none px-6 py-4 border-b border-black flex justify-between items-center bg-[#F5ECDE] z-10">
    <svg width="78" height="25" viewBox="0 0 78 25" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M32.4644 2.36295C31.1941 2.36295 30.1454 2.86342 29.3183 3.86436C28.5207 4.83586 27.9889 5.98399 27.7231 7.30877L27.6788 7.52956C27.6788 7.73564 27.7378 7.89756 27.856 8.01531C28.0037 8.10363 28.1957 8.14779 28.4321 8.14779H35.965C36.2309 8.14779 36.4229 8.07419 36.5411 7.92699C36.6888 7.7798 36.7479 7.58844 36.7183 7.35293C36.5706 5.93983 36.1423 4.76226 35.4333 3.8202C34.7243 2.8487 33.7347 2.36295 32.4644 2.36295ZM24.1338 12.4312C24.1338 10.5177 24.4588 8.64826 25.1087 6.82302C25.7586 4.99778 26.7778 3.48165 28.1662 2.27463C29.5842 1.03818 31.3714 0.41995 33.5279 0.41995C36.0684 0.41995 38.0329 1.24425 39.4213 2.89286C40.8098 4.54146 41.5778 6.55806 41.7256 8.94265V9.03097C41.7256 9.502 41.4745 9.73752 40.9723 9.73752H28.3877C27.856 9.73752 27.6049 10.0025 27.6344 10.5324C27.7231 12.0338 28.0332 13.5058 28.565 14.9483C29.0967 16.3908 29.8943 17.5831 30.9578 18.5252C32.0213 19.4672 33.3359 19.9383 34.9016 19.9383C36.3491 19.9383 37.5012 19.5408 38.3579 18.746C39.2146 17.9511 39.9383 16.8766 40.5291 15.5224C40.6473 15.1396 40.8689 14.9483 41.1938 14.9483C41.4006 14.9483 41.5483 15.0366 41.6369 15.2132C41.7256 15.3604 41.7403 15.5665 41.6812 15.8315C41.2086 17.9805 40.2337 19.8941 38.7567 21.5722C37.2796 23.2502 35.3594 24.0892 32.9962 24.0892C31.076 24.0892 29.4512 23.5299 28.1219 22.4112C26.7925 21.263 25.7881 19.8058 25.1087 18.0394C24.4588 16.2436 24.1338 14.3742 24.1338 12.4312Z" fill="#1F1C19"/>
    <path d="M52.7907 3.95268C52.4657 3.95268 52.0669 4.24707 51.5943 4.83586C51.1216 5.39521 50.6342 6.17535 50.132 7.17629C49.9843 7.47068 49.9104 7.80924 49.9104 8.19195V16.7588C49.9104 18.2013 49.94 19.2612 49.9991 19.9383C50.0581 20.5859 50.2206 21.1011 50.4865 21.4838C50.7819 21.8371 51.2545 22.0432 51.9044 22.1021C52.4066 22.1609 52.6577 22.4406 52.6577 22.9411C52.6577 23.1766 52.5839 23.368 52.4362 23.5151C52.318 23.6623 52.1408 23.7359 51.9044 23.7359H43.9727C43.7363 23.7359 43.5443 23.6623 43.3966 23.5151C43.2785 23.368 43.2194 23.1766 43.2194 22.9411C43.2194 22.4406 43.4705 22.1609 43.9727 22.1021C44.6226 22.0432 45.0805 21.8371 45.3463 21.4838C45.6417 21.1011 45.819 20.5859 45.8781 19.9383C45.9372 19.2612 45.9667 18.2013 45.9667 16.7588V8.54522C45.9667 6.92605 45.8928 5.79264 45.7451 5.14497C45.5974 4.4973 45.2134 4.17347 44.593 4.17347C44.5044 4.17347 44.3124 4.20291 44.017 4.26179C43.8988 4.29123 43.7363 4.30595 43.5295 4.30595C43.2046 4.30595 42.9535 4.15875 42.7762 3.86436C42.7467 3.80548 42.7319 3.71716 42.7319 3.5994C42.7319 3.27557 42.9683 2.9959 43.4409 2.76038L46.011 1.61224L48.2709 0.640745C48.5663 0.493548 48.8765 0.41995 49.2014 0.41995C49.6741 0.41995 49.9104 0.684904 49.9104 1.21481V3.33445C49.9104 3.77604 50.0286 3.99683 50.2649 3.99683C50.4717 3.99683 50.6637 3.84964 50.841 3.55524C52.1703 1.46505 53.6326 0.41995 55.2278 0.41995C56.1436 0.41995 56.9412 0.684904 57.6207 1.21481C58.3001 1.74472 58.6398 2.43655 58.6398 3.29029C58.6398 4.02627 58.374 4.60034 57.8422 5.01249C57.3105 5.39521 56.7344 5.58656 56.1141 5.58656C55.7005 5.58656 55.3312 5.51296 55.0063 5.36577C54.7109 5.18913 54.3416 4.92418 53.8985 4.5709C53.4258 4.15875 53.0566 3.95268 52.7907 3.95268Z" fill="#1F1C19"/>
    <path d="M63.9285 24.0892C62.3333 24.0892 61.1073 23.5004 60.2506 22.3229C59.394 21.1453 58.9656 19.8058 58.9656 18.3044C58.9656 16.7441 59.4678 15.3899 60.4722 14.2417C61.4766 13.0936 62.7025 12.1368 64.1501 11.3714C65.5976 10.606 67.4587 9.75224 69.7333 8.81017C70.1469 8.63354 70.3537 8.32443 70.3537 7.88283C70.3242 5.99871 70.0731 4.5709 69.6004 3.5994C69.1277 2.59846 68.1529 2.09799 66.6758 2.09799C65.4646 2.09799 64.667 2.45127 64.283 3.15781C63.9285 3.86436 63.766 4.8653 63.7956 6.16063C63.7956 6.8083 63.6331 7.38237 63.3081 7.88283C62.9832 8.35386 62.4662 8.58938 61.7572 8.58938C61.1073 8.58938 60.6051 8.35386 60.2506 7.88283C59.9257 7.4118 59.7632 6.83774 59.7632 6.16063C59.7632 5.15969 60.0882 4.21763 60.7381 3.33445C61.388 2.45127 62.289 1.74472 63.4411 1.21481C64.5932 0.684904 65.9078 0.41995 67.3848 0.41995C69.3641 0.41995 70.8559 0.729063 71.8603 1.34729C72.8647 1.93608 73.5294 2.76038 73.8543 3.8202C74.1793 4.88002 74.3418 6.29311 74.3418 8.05947V18.8343C74.3418 20.1591 74.6519 20.8214 75.2723 20.8214C75.5677 20.8214 75.937 20.6154 76.3801 20.2032C76.6164 19.9677 76.838 19.8499 77.0448 19.8499C77.1629 19.8499 77.2811 19.8941 77.3993 19.9824C77.547 20.1296 77.6208 20.2768 77.6208 20.424C77.6208 20.5712 77.547 20.7478 77.3993 20.9539C75.8631 23.0147 74.327 24.0451 72.7908 24.0451C71.4024 24.0451 70.6196 23.1913 70.4423 21.4838C70.4128 21.1011 70.3094 20.9098 70.1321 20.9098C69.9844 20.9098 69.8515 20.9686 69.7333 21.0864C68.6403 22.0579 67.6655 22.8086 66.8088 23.3385C65.9521 23.839 64.992 24.0892 63.9285 24.0892ZM62.998 17.0679C62.998 18.1277 63.2638 19.0698 63.7956 19.8941C64.3273 20.689 65.0363 21.0864 65.9225 21.0864C66.9565 21.0864 68.2858 20.4093 69.9106 19.0551C70.206 18.7901 70.3537 18.4663 70.3537 18.0836V11.2831C70.3537 10.8709 70.1469 10.6649 69.7333 10.6649C69.5856 10.6649 69.3936 10.709 69.1573 10.7973C67.1189 11.71 65.5828 12.6226 64.5489 13.5352C63.5149 14.4478 62.998 15.6254 62.998 17.0679Z" fill="#1F1C19"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M13.012 23.8833C13.2752 23.8607 13.498 23.6798 13.571 23.4268L14.658 20.677C14.9196 19.7709 14.6447 19.3868 14.2622 18.5245C14.064 18.0777 13.8785 17.656 13.717 17.2888C13.4315 16.6394 13.2211 16.161 13.1489 16.0182L8.95685 7.37787C8.66018 6.76011 8.37309 6.21671 8.12044 5.73848C7.02554 3.66601 6.57728 2.81755 8.79773 2.44543C9.50409 2.34008 9.83235 1.99991 9.79019 1.51339C9.74803 1.02685 9.32171 0.751622 8.65592 0.808921L0.799459 1.48505C-0.31021 1.58055 -0.268669 3.09201 0.948939 3.21002C1.89639 3.30672 3.20215 4.44203 4.7845 7.73695L12.1595 23.3329C12.3715 23.7156 12.657 23.9139 13.012 23.8833Z" fill="#1F1C19"/>
    <path d="M21.1718 8.41854C21.5594 7.971 22.6199 6.33889 22.5905 5.04061C22.5905 2.07981 20.0827 -0.0648501 17.1235 0.00149798C14.1644 0.0678461 11.8143 2.61486 11.8745 5.28088C11.9347 7.94691 14.3823 10.0544 17.3415 9.98801C17.4454 9.98568 17.5486 9.9807 17.651 9.97314C17.6289 10.0731 17.6039 10.1767 17.576 10.284C17.4078 10.9303 16.7827 12.416 16.73 12.5614C16.4455 13.1768 17.2768 13.6904 17.7034 13.1628L21.1718 8.41854Z" fill="#1F1C19"/>
    </svg>
  </header>

  <main class="flex-1 overflow-y-auto p-4 relative flex flex-col items-center">
    <div class="absolute inset-0 opacity-5 pointer-events-none bg-contain" 
         style="background-image: url('assets/texture-paper.png'); mix-blend-mode: multiply;">
    </div>

    <div class="w-full max-w-3xl space-y-6 pb-4 z-0">
      
      @if (messages().length === 0) {
        <div class="flex flex-col items-center justify-center h-64 text-center opacity-40">
            <svg width="43" height="43" viewBox="0 0 43 43" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M24.3845 42.346C24.8776 42.3034 25.2951 41.9633 25.432 41.4876L27.469 36.3166C27.9592 34.6127 27.4441 35.1733 26.7272 33.5518C26.3559 32.7117 26.0082 31.9185 25.7056 31.2281C25.1705 30.007 24.7762 29.1074 24.6408 28.8388L16.7851 13.8738C16.2291 12.7121 15.6911 11.6903 15.2176 10.791C13.1658 6.89381 12.3258 5.2983 16.4869 4.59854C17.8106 4.40044 18.4257 3.76077 18.3467 2.84587C18.2677 1.93096 17.4688 1.4134 16.2211 1.52115L1.49818 2.79259C-0.581331 2.97218 -0.503482 5.81442 1.7783 6.03634C3.55382 6.21818 6.0008 8.35308 8.9661 14.5491L22.7868 41.3109C23.1841 42.0306 23.7191 42.4034 24.3845 42.346Z" fill="black"/>
            <path d="M39.6757 15.8308C40.4021 14.9892 42.3894 11.9201 42.3345 9.4787C42.3345 3.91101 37.6348 -0.121948 32.0893 0.0028169C26.5439 0.127582 22.1399 4.91715 22.2527 9.93052C22.3655 14.9439 26.9524 18.9069 32.4978 18.7821C32.6926 18.7777 32.886 18.7684 33.0778 18.7541C33.0365 18.9421 32.9896 19.1369 32.9373 19.3388C32.622 20.554 31.4506 23.3478 31.3519 23.6213C30.8188 24.7785 32.3765 25.7443 33.176 24.7522L39.6757 15.8308Z" fill="black"/>
            </svg>          
        <p class="font-medium">Pose une question à Vera</p>
        </div>
      }

      @for (message of messages(); track message.id) {
        @if (message.role === 'user') {
          <div class="flex justify-end w-full animate-in fade-in slide-in-from-bottom-2">
            <div class="max-w-[85%] bg-[#FFDEE0] px-5 py-4 rounded-2xl rounded-br-none shadow-sm border border-transparent">
              <p class="whitespace-pre-wrap text-base leading-relaxed">{{ message.content }}</p>
            </div>
          </div>
        }

        @if (message.role === 'assistant') {
          <div class="flex justify-start w-full gap-3 animate-in fade-in slide-in-from-bottom-2">
            <div class="flex-shrink-0 w-10 h-10 rounded-full overflow-hidden bg-black mt-1 border border-gray-200">
              <img src="https://ui-avatars.com/api/?name=Vera&background=000&color=fff" alt="Vera" class="w-full h-full object-cover">
            </div>

            <div class="flex flex-col max-w-[85%]">
              <div class="bg-white px-5 py-4 rounded-2xl rounded-tl-none shadow-sm border border-gray-100">
                
                @if (message.steps && message.steps.length > 0) {
                  <div class="mb-3 pl-3 border-l-2 border-[#DBF9BE] space-y-1">
                    @for (step of message.steps; track $index) {
                      <p class="text-xs text-gray-400 italic font-mono">{{ step }}</p>
                    }
                  </div>
                }

                <div class="text-base leading-relaxed whitespace-pre-wrap min-h-[1.5em]">
                   {{ message.content }}
                   @if (message.isStreaming) {
                     <span class="inline-block w-2 h-4 bg-black animate-pulse ml-1 align-middle"></span>
                   }
                </div>
              </div>
            </div>
          </div>
        }
      }
      
      @if (isLoading() && messages()[messages().length - 1]?.role === 'user') {
         <div class="flex justify-start w-full gap-3">
            <div class="w-10 h-10 rounded-full bg-black animate-pulse"></div>
         </div>
      }
    </div>
  </main>

  <footer class="flex-none bg-[#F5ECDE] p-4 pb-6">
    <div class="max-w-3xl mx-auto w-full">
      
      @if (selectedFiles().length > 0) {
        <div class="flex gap-2 mb-2 overflow-x-auto px-2">
          @for (file of selectedFiles(); track file.name) {
            <div class="bg-white px-3 py-1 rounded-lg text-xs border border-gray-200 flex items-center gap-2 shadow-sm">
              <span class="truncate max-w-[150px]">{{ file.name }}</span>
              <button (click)="removeFile(file)" class="text-red-400 hover:text-red-600">×</button>
            </div>
          }
        </div>
      }

      @if (showUrlInput()) {
         <div class="mb-2 bg-white rounded-xl p-2 flex gap-2 shadow-sm border border-gray-200 animate-in slide-in-from-bottom-2">
           <input [(ngModel)]="urlInput" type="url" placeholder="https://..." class="flex-1 outline-none text-sm px-2">
           <button (click)="addFromUrl()" class="text-xs bg-black text-white px-3 py-1 rounded-lg">Add</button>
         </div>
      }

      <div class="flex items-end gap-3">
        
        <button class="flex-shrink-0 w-12 h-12 bg-black text-white rounded-full flex items-center justify-center hover:bg-gray-800 transition-transform hover:scale-105 active:scale-95 shadow-md">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
          </svg>
        </button>

        <div class="flex-1 relative shadow-sm rounded-[2rem] bg-white transition-shadow focus-within:shadow-md border border-transparent focus-within:border-gray-200">
          
          <div class="absolute left-3 bottom-3 flex gap-1 z-10">
             <input type="file" #fileInput (change)="onFileSelected($event)" multiple class="hidden" [accept]="ACCEPTED_MIME_TYPES.join(',')">
             <button (click)="fileInput.click()" class="p-1.5 text-gray-400 hover:text-black rounded-full hover:bg-gray-100 transition-colors" title="Ajouter fichier">
               <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path></svg>
             </button>
             <button (click)="toggleUrlInput()" class="p-1.5 text-gray-400 hover:text-black rounded-full hover:bg-gray-100 transition-colors" title="Ajouter Lien">
               <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
             </button>
          </div>

          <textarea 
            [(ngModel)]="inputText" 
            (keydown.enter)="handleSubmit($any($event))" 
            (paste)="onPaste($any($event))"
            placeholder="Ecrivez ici..." 
            rows="1" 
            class="w-full py-4 pl-20 pr-12 bg-transparent rounded-[2rem] resize-none outline-none text-gray-800 placeholder-gray-400 max-h-32"
            style="min-height: 56px;"
          ></textarea>

          <button 
            (click)="handleSubmit()" 
            [disabled]="!inputText.trim() && selectedFiles().length === 0"
            class="absolute right-2 bottom-2 p-2 rounded-full transition-colors disabled:opacity-30 disabled:cursor-not-allowed hover:bg-gray-100"
          >
            <svg class="w-6 h-6 text-black transform rotate-90" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path>
            </svg>
          </button>
        </div>
      </div>
      
      <div class="text-center mt-4">
          <p class="text-xs text-gray-500">
            Pour soutenir Vera, répond à ce <a href="#" class="underline hover:text-black">sondage</a>
          </p>
      </div>

    </div>
  </footer>
</div>
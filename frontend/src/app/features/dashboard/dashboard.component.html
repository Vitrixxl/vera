<div class="flex flex-col min-h-screen font-sans text-[#000000] bg-cover bg-center bg-fixed"
     style="background-image: url('/images/background.jpg'); background-color: #F5ECDE;">
     
     
     
     <header class="flex-none px-6 py-4 border-b border-black flex items-center bg-[#F5ECDE] z-10 relative">
    
    <!-- Logo à gauche -->
    <div class="flex-none">
        <svg width="78" height="25" viewBox="0 0 78 25" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M32.4644 2.36295C31.1941 2.36295 30.1454 2.86342 29.3183 3.86436C28.5207 4.83586 27.9889 5.98399 27.7231 7.30877L27.6788 7.52956C27.6788 7.73564 27.7378 7.89756 27.856 8.01531C28.0037 8.10363 28.1957 8.14779 28.4321 8.14779H35.965C36.2309 8.14779 36.4229 8.07419 36.5411 7.92699C36.6888 7.7798 36.7479 7.58844 36.7183 7.35293C36.5706 5.93983 36.1423 4.76226 35.4333 3.8202C34.7243 2.8487 33.7347 2.36295 32.4644 2.36295ZM24.1338 12.4312C24.1338 10.5177 24.4588 8.64826 25.1087 6.82302C25.7586 4.99778 26.7778 3.48165 28.1662 2.27463C29.5842 1.03818 31.3714 0.41995 33.5279 0.41995C36.0684 0.41995 38.0329 1.24425 39.4213 2.89286C40.8098 4.54146 41.5778 6.55806 41.7256 8.94265V9.03097C41.7256 9.502 41.4745 9.73752 40.9723 9.73752H28.3877C27.856 9.73752 27.6049 10.0025 27.6344 10.5324C27.7231 12.0338 28.0332 13.5058 28.565 14.9483C29.0967 16.3908 29.8943 17.5831 30.9578 18.5252C32.0213 19.4672 33.3359 19.9383 34.9016 19.9383C36.3491 19.9383 37.5012 19.5408 38.3579 18.746C39.2146 17.9511 39.9383 16.8766 40.5291 15.5224C40.6473 15.1396 40.8689 14.9483 41.1938 14.9483C41.4006 14.9483 41.5483 15.0366 41.6369 15.2132C41.7256 15.3604 41.7403 15.5665 41.6812 15.8315C41.2086 17.9805 40.2337 19.8941 38.7567 21.5722C37.2796 23.2502 35.3594 24.0892 32.9962 24.0892C31.076 24.0892 29.4512 23.5299 28.1219 22.4112C26.7925 21.263 25.7881 19.8058 25.1087 18.0394C24.4588 16.2436 24.1338 14.3742 24.1338 12.4312Z" fill="#1F1C19"/>
        <path d="M52.7907 3.95268C52.4657 3.95268 52.0669 4.24707 51.5943 4.83586C51.1216 5.39521 50.6342 6.17535 50.132 7.17629C49.9843 7.47068 49.9104 7.80924 49.9104 8.19195V16.7588C49.9104 18.2013 49.94 19.2612 49.9991 19.9383C50.0581 20.5859 50.2206 21.1011 50.4865 21.4838C50.7819 21.8371 51.2545 22.0432 51.9044 22.1021C52.4066 22.1609 52.6577 22.4406 52.6577 22.9411C52.6577 23.1766 52.5839 23.368 52.4362 23.5151C52.318 23.6623 52.1408 23.7359 51.9044 23.7359H43.9727C43.7363 23.7359 43.5443 23.6623 43.3966 23.5151C43.2785 23.368 43.2194 23.1766 43.2194 22.9411C43.2194 22.4406 43.4705 22.1609 43.9727 22.1021C44.6226 22.0432 45.0805 21.8371 45.3463 21.4838C45.6417 21.1011 45.819 20.5859 45.8781 19.9383C45.9372 19.2612 45.9667 18.2013 45.9667 16.7588V8.54522C45.9667 6.92605 45.8928 5.79264 45.7451 5.14497C45.5974 4.4973 45.2134 4.17347 44.593 4.17347C44.5044 4.17347 44.3124 4.20291 44.017 4.26179C43.8988 4.29123 43.7363 4.30595 43.5295 4.30595C43.2046 4.30595 42.9535 4.15875 42.7762 3.86436C42.7467 3.80548 42.7319 3.71716 42.7319 3.5994C42.7319 3.27557 42.9683 2.9959 43.4409 2.76038L46.011 1.61224L48.2709 0.640745C48.5663 0.493548 48.8765 0.41995 49.2014 0.41995C49.6741 0.41995 49.9104 0.684904 49.9104 1.21481V3.33445C49.9104 3.77604 50.0286 3.99683 50.2649 3.99683C50.4717 3.99683 50.6637 3.84964 50.841 3.55524C52.1703 1.46505 53.6326 0.41995 55.2278 0.41995C56.1436 0.41995 56.9412 0.684904 57.6207 1.21481C58.3001 1.74472 58.6398 2.43655 58.6398 3.29029C58.6398 4.02627 58.374 4.60034 57.8422 5.01249C57.3105 5.39521 56.7344 5.58656 56.1141 5.58656C55.7005 5.58656 55.3312 5.51296 55.0063 5.36577C54.7109 5.18913 54.3416 4.92418 53.8985 4.5709C53.4258 4.15875 53.0566 3.95268 52.7907 3.95268Z" fill="#1F1C19"/>
        <path d="M63.9285 24.0892C62.3333 24.0892 61.1073 23.5004 60.2506 22.3229C59.394 21.1453 58.9656 19.8058 58.9656 18.3044C58.9656 16.7441 59.4678 15.3899 60.4722 14.2417C61.4766 13.0936 62.7025 12.1368 64.1501 11.3714C65.5976 10.606 67.4587 9.75224 69.7333 8.81017C70.1469 8.63354 70.3537 8.32443 70.3537 7.88283C70.3242 5.99871 70.0731 4.5709 69.6004 3.5994C69.1277 2.59846 68.1529 2.09799 66.6758 2.09799C65.4646 2.09799 64.667 2.45127 64.283 3.15781C63.9285 3.86436 63.766 4.8653 63.7956 6.16063C63.7956 6.8083 63.6331 7.38237 63.3081 7.88283C62.9832 8.35386 62.4662 8.58938 61.7572 8.58938C61.1073 8.58938 60.6051 8.35386 60.2506 7.88283C59.9257 7.4118 59.7632 6.83774 59.7632 6.16063C59.7632 5.15969 60.0882 4.21763 60.7381 3.33445C61.388 2.45127 62.289 1.74472 63.4411 1.21481C64.5932 0.684904 65.9078 0.41995 67.3848 0.41995C69.3641 0.41995 70.8559 0.729063 71.8603 1.34729C72.8647 1.93608 73.5294 2.76038 73.8543 3.8202C74.1793 4.88002 74.3418 6.29311 74.3418 8.05947V18.8343C74.3418 20.1591 74.6519 20.8214 75.2723 20.8214C75.5677 20.8214 75.937 20.6154 76.3801 20.2032C76.6164 19.9677 76.838 19.8499 77.0448 19.8499C77.1629 19.8499 77.2811 19.8941 77.3993 19.9824C77.547 20.1296 77.6208 20.2768 77.6208 20.424C77.6208 20.5712 77.547 20.7478 77.3993 20.9539C75.8631 23.0147 74.327 24.0451 72.7908 24.0451C71.4024 24.0451 70.6196 23.1913 70.4423 21.4838C70.4128 21.1011 70.3094 20.9098 70.1321 20.9098C69.9844 20.9098 69.8515 20.9686 69.7333 21.0864C68.6403 22.0579 67.6655 22.8086 66.8088 23.3385C65.9521 23.839 64.992 24.0892 63.9285 24.0892ZM62.998 17.0679C62.998 18.1277 63.2638 19.0698 63.7956 19.8941C64.3273 20.689 65.0363 21.0864 65.9225 21.0864C66.9565 21.0864 68.2858 20.4093 69.9106 19.0551C70.206 18.7901 70.3537 18.4663 70.3537 18.0836V11.2831C70.3537 10.8709 70.1469 10.6649 69.7333 10.6649C69.5856 10.6649 69.3936 10.709 69.1573 10.7973C67.1189 11.71 65.5828 12.6226 64.5489 13.5352C63.5149 14.4478 62.998 15.6254 62.998 17.0679Z" fill="#1F1C19"/>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M13.012 23.8833C13.2752 23.8607 13.498 23.6798 13.571 23.4268L14.658 20.677C14.9196 19.7709 14.6447 19.3868 14.2622 18.5245C14.064 18.0777 13.8785 17.656 13.717 17.2888C13.4315 16.6394 13.2211 16.161 13.1489 16.0182L8.95685 7.37787C8.66018 6.76011 8.37309 6.21671 8.12044 5.73848C7.02554 3.66601 6.57728 2.81755 8.79773 2.44543C9.50409 2.34008 9.83235 1.99991 9.79019 1.51339C9.74803 1.02685 9.32171 0.751622 8.65592 0.808921L0.799459 1.48505C-0.31021 1.58055 -0.268669 3.09201 0.948939 3.21002C1.89639 3.30672 3.20215 4.44203 4.7845 7.73695L12.1595 23.3329C12.3715 23.7156 12.657 23.9139 13.012 23.8833Z" fill="#1F1C19"/>
        <path d="M21.1718 8.41854C21.5594 7.971 22.6199 6.33889 22.5905 5.04061C22.5905 2.07981 20.0827 -0.0648501 17.1235 0.00149798C14.1644 0.0678461 11.8143 2.61486 11.8745 5.28088C11.9347 7.94691 14.3823 10.0544 17.3415 9.98801C17.4454 9.98568 17.5486 9.9807 17.651 9.97314C17.6289 10.0731 17.6039 10.1767 17.576 10.284C17.4078 10.9303 16.7827 12.416 16.73 12.5614C16.4455 13.1768 17.2768 13.6904 17.7034 13.1628L21.1718 8.41854Z" fill="#1F1C19"/>
        </svg>    
    </div>

    <!-- Titre Dashboard centré absolument -->
    <div class="absolute left-1/2 transform -translate-x-1/2">
        <span class="font-bold text-lg">Dashboard</span>
    </div>

  </header>

      <main class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
        
        <div class="flex justify-end gap-4">
          <button
            (click)="downloadCSV()"
            [disabled]="downloadingCSV()"
            class="group px-6 py-2.5 text-sm font-medium bg-[#22C55E] text-white rounded-full shadow-lg hover:bg-green-600 hover:shadow-xl transition-all flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed"
          >
            @if (downloadingCSV()) {
              <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            } @else {
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
              </svg>
            }
            Exporter CSV
          </button>
          <button
            (click)="goToSurvey()"
            class="px-6 py-2.5 text-sm font-medium bg-[#4F46E5] text-white rounded-full shadow-lg hover:bg-indigo-600 hover:shadow-xl transition-all flex items-center gap-2"
          >
            Voir le Survey
          </button>
        </div>

        @if (isLoading()) {
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            @for (i of [1, 2, 3, 4]; track i) {
              <div class="bg-white rounded-xl border border-gray-900 p-3 h-20 animate-pulse"></div>
            }
          </div>
        } @else {
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="bg-white rounded-xl border border-gray-900 p-3 flex items-center gap-3 shadow-sm">
              <div class="flex-shrink-0 w-14 h-14 bg-[#5542F6] rounded-xl flex items-center justify-center text-white">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              </div>
              <div class="flex flex-col justify-center">
                <p class="text-sm font-medium text-gray-700 leading-tight mb-1">Total Réponses</p>
                <p class="text-2xl font-bold text-gray-900 leading-none">{{ stats()?.total || 0 }}</p>
              </div>
            </div>

            <div class="bg-white rounded-xl border border-gray-900 p-3 flex items-center gap-3 shadow-sm">
              <div class="flex-shrink-0 w-14 h-14 bg-[#EAB308] rounded-xl flex items-center justify-center text-white">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>
              </div>
              <div class="flex flex-col justify-center">
                <p class="text-sm font-medium text-gray-700 leading-tight mb-1">Note Moyenne</p>
                <p class="text-2xl font-bold text-gray-900 leading-none">{{ stats()?.avgExperienceRating || 0 }}/5</p>
              </div>
            </div>

            <div class="bg-white rounded-xl border border-gray-900 p-3 flex items-center gap-3 shadow-sm">
              <div class="flex-shrink-0 w-14 h-14 bg-[#22C55E] rounded-xl flex items-center justify-center text-white">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" />
                </svg>
              </div>
              <div class="flex flex-col justify-center">
                <p class="text-sm font-medium text-gray-700 leading-tight mb-1">Recommandent</p>
                <p class="text-2xl font-bold text-gray-900 leading-none">{{ stats()?.recommendRate || 0 }}/5</p>
              </div>
            </div>

            <div class="bg-white rounded-xl border border-gray-900 p-3 flex items-center gap-3 shadow-sm">
              <div class="flex-shrink-0 w-14 h-14 bg-[#3B82F6] rounded-xl flex items-center justify-center text-white">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
              </div>
              <div class="flex flex-col justify-center">
                <p class="text-sm font-medium text-gray-700 leading-tight mb-1">Réutiliseront</p>
                <p class="text-2xl font-bold text-gray-900 leading-none">{{ stats()?.reuseRate || 0 }}%</p>
              </div>
            </div>
          </div>
        }

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          
          <div class="bg-white rounded-xl border border-gray-900 p-6 flex flex-col h-full shadow-sm relative">
            <h3 class="text-base font-bold text-gray-900 mb-4">Rechercher des surveys</h3>
            <div class="relative w-full">
              <input
                type="text"
                [(ngModel)]="surveySearchQuery"
                (keyup.enter)="searchSurveys()"
                placeholder="Ecrivez ici..."
                class="w-full bg-gray-100 border-none rounded-lg py-3 px-4 pr-10 text-sm focus:ring-2 focus:ring-gray-900 placeholder-gray-500"
              />
              <button 
                (click)="searchSurveys()"
                [disabled]="searchingSurveys()"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-900"
              >
                @if (searchingSurveys()) {
                  <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                } @else {
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                }
              </button>
            </div>
            @if (surveySearchResults().length > 0) {
              <div class="absolute top-full left-0 right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-xl z-10 max-h-64 overflow-y-auto">
                @for (result of surveySearchResults(); track result.id) {
                  <div (click)="openSurveyDialog(result)" class="p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-0">
                    <div class="flex items-center justify-between">
                      <span class="text-xs font-bold px-2 py-0.5 rounded bg-gray-100">{{ result.q5ExperienceRating }}/5</span>
                      <span class="text-xs text-gray-400">{{ formatDate(result.createdAt) }}</span>
                    </div>
                    @if (result.q13Comment) { <p class="text-xs text-gray-600 mt-1 line-clamp-2">{{ result.q13Comment }}</p> }
                  </div>
                }
              </div>
            }
          </div>

          <div class="bg-white rounded-xl border border-gray-900 p-6 flex flex-col h-full shadow-sm relative">
            <h3 class="text-base font-bold text-gray-900 mb-4">Rechercher des question</h3>
            <div class="relative w-full">
              <input
                type="text"
                [(ngModel)]="questionSearchQuery"
                (keyup.enter)="searchQuestions()"
                placeholder="Ecrivez ici..."
                class="w-full bg-gray-100 border-none rounded-lg py-3 px-4 pr-10 text-sm focus:ring-2 focus:ring-gray-900 placeholder-gray-500"
              />
              <button 
                (click)="searchQuestions()"
                [disabled]="searchingQuestions()"
                class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-900"
              >
                 @if (searchingQuestions()) {
                  <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                } @else {
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                }
              </button>
            </div>
             @if (questionSearchResults().length > 0) {
              <div class="absolute top-full left-0 right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-xl z-10 max-h-64 overflow-y-auto">
                @for (result of questionSearchResults(); track result.id) {
                  <div class="p-3 hover:bg-gray-50 border-b border-gray-100 last:border-0">
                    <p class="text-sm text-gray-800">{{ result.question }}</p>
                    <p class="text-xs text-gray-500 mt-1">{{ formatDate(result.createdAt) }}</p>
                  </div>
                }
              </div>
            }
          </div>

          <div class="bg-white rounded-xl border border-gray-900 p-6 shadow-sm flex flex-col h-full">
            <h3 class="text-base font-bold text-gray-900 mb-4">Questions tendances</h3>
            <div class="flex-1 overflow-y-auto pr-1 custom-scrollbar">
              @if (loadingHotQuestions()) {
                <div class="space-y-3 animate-pulse">
                  <div class="h-4 bg-gray-200 rounded w-full"></div>
                  <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                  <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                </div>
              } @else if (hotQuestions().length > 0) {
                <ul class="space-y-4">
                  @for (q of hotQuestions(); track q.id; let i = $index) {
                    <li class="flex items-start gap-3">
                      <span class="flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-bold">
                        {{ i + 1 }}.
                      </span>
                      <span class="text-sm text-gray-700 leading-snug pt-0.5">{{ q.question }}</span>
                    </li>
                  }
                </ul>
              } @else {
                <p class="text-sm text-gray-400 italic">Aucune donnée</p>
              }
            </div>
          </div>
        </div>

        @if (!isLoading() && stats()) {
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            
            <div class="bg-white rounded-xl border border-gray-900 p-6 shadow-sm min-h-[300px] flex flex-col">
              <h3 class="text-base font-bold text-gray-900 mb-2">Note d'expérience (Q5)</h3>
              <p class="text-xs text-gray-400 mb-4">1 - Décevant / 5 - Excellent</p>
              <div class="flex-1 relative w-full h-full">
                <canvas #ratingChart></canvas>
              </div>
            </div>

            <div class="bg-white rounded-xl border border-gray-900 p-6 shadow-sm min-h-[300px] flex flex-col">
              <h3 class="text-base font-bold text-gray-900 mb-4">Recommandation (Q9)</h3>
              <div class="flex-1 relative w-full h-full flex items-center justify-center">
                 <canvas #recommendChart></canvas>
              </div>
            </div>

            <div class="bg-white rounded-xl border border-gray-900 p-6 shadow-sm min-h-[300px] flex flex-col">
              <h3 class="text-base font-bold text-gray-900 mb-4">Ce qui a plu (Q6)</h3>
              <div class="flex-1 relative w-full h-full flex items-center justify-center">
                 <canvas #likedChart></canvas>
              </div>
            </div>

            <div class="bg-white rounded-xl border border-gray-900 p-6 shadow-sm min-h-[300px] flex flex-col">
              <h3 class="text-base font-bold text-gray-900 mb-4">Canaux utilisés (Q1)</h3>
              <div class="flex-1 relative w-full h-full flex items-center justify-center">
                <canvas #channelsChart></canvas>
              </div>
            </div>

            <div class="bg-white rounded-xl border border-gray-900 p-6 shadow-sm min-h-[300px] flex flex-col">
              <h3 class="text-base font-bold text-gray-900 mb-4">Découverte (Q12)</h3>
              <div class="flex-1 relative w-full h-full flex items-center justify-center">
                <canvas #discoveryChart></canvas>
              </div>
            </div>

             <div class="bg-white rounded-xl border border-gray-900 p-6 shadow-sm min-h-[300px] flex flex-col">
              <h3 class="text-base font-bold text-gray-900 mb-4">À améliorer (Q7)</h3>
              <div class="flex-1 relative w-full h-full">
                <canvas #improvementsChart></canvas>
              </div>
            </div>

          </div>
        }

        <div class="bg-white rounded-xl border border-gray-900 shadow-sm overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200 bg-gray-50/50">
            <h2 class="text-lg font-bold text-gray-900">Réponses récentes</h2>
          </div>
          
          @if (isLoading()) {
            <div class="p-8 text-center text-gray-500">Chargement...</div>
          } @else if (surveys().length === 0) {
             <div class="p-8 text-center text-gray-500">Aucune réponse</div>
          } @else {
            <div class="divide-y divide-gray-100">
              @for (survey of surveys(); track survey.id) {
                <div (click)="openSurveyDialog(survey)" class="p-6 hover:bg-gray-50 transition-colors cursor-pointer flex items-center justify-between group">
                  <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-lg flex items-center justify-center font-bold text-lg"
                      [class.bg-green-100]="survey.q5ExperienceRating >= 4"
                      [class.text-green-700]="survey.q5ExperienceRating >= 4"
                      [class.bg-yellow-100]="survey.q5ExperienceRating === 3"
                      [class.text-yellow-700]="survey.q5ExperienceRating === 3"
                      [class.bg-red-100]="survey.q5ExperienceRating <= 2"
                      [class.text-red-700]="survey.q5ExperienceRating <= 2"
                    >
                      {{ survey.q5ExperienceRating }}
                    </div>
                    
                    <div>
                      <div class="flex gap-2 mb-1">
                         @for (channel of survey.q1Channels; track channel) {
                            <span class="text-xs font-medium uppercase tracking-wider text-gray-500 bg-gray-100 px-2 py-0.5 rounded">{{ getLabel('q1Channels', channel) }}</span>
                         }
                      </div>
                      <p class="text-sm text-gray-400">{{ formatDate(survey.createdAt) }}</p>
                    </div>
                  </div>
                  
                  <svg class="w-5 h-5 text-gray-300 group-hover:text-gray-900 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </div>
              }
            </div>
             @if (hasMore()) {
              <div class="p-4 text-center border-t border-gray-100">
                <button (click)="loadMoreSurveys()" [disabled]="loadingMore()" class="text-sm text-indigo-600 font-medium hover:underline">
                  {{ loadingMore() ? 'Chargement...' : 'Voir plus' }}
                </button>
              </div>
            }
          }
        </div>

      </main>

      @if (selectedSurvey()) {
        <div class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm" (click)="closeSurveyDialog()">
          <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto border border-gray-900" (click)="$event.stopPropagation()">
            <div class="sticky top-0 bg-white border-b border-gray-100 px-6 py-4 flex items-center justify-between z-10">
              <h2 class="text-xl font-bold text-gray-900">Détail de la réponse</h2>
              <button (click)="closeSurveyDialog()" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <svg class="w-5 h-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
            
            <div class="p-6 space-y-8">
              <div class="flex flex-col items-center justify-center py-6 bg-gray-50 rounded-lg border border-gray-200 border-dashed">
                <span class="text-5xl font-bold mb-2"
                  [class.text-green-600]="selectedSurvey()!.q5ExperienceRating >= 4"
                  [class.text-yellow-500]="selectedSurvey()!.q5ExperienceRating === 3"
                  [class.text-red-500]="selectedSurvey()!.q5ExperienceRating <= 2"
                >{{ selectedSurvey()!.q5ExperienceRating }}<span class="text-2xl text-gray-400">/5</span></span>
                <span class="text-sm text-gray-500">{{ formatFullDate(selectedSurvey()!.createdAt) }}</span>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                 <div class="space-y-1">
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Canaux (Q1)</p>
                    <p class="text-sm font-medium text-gray-900">
                      {{ selectedSurvey()!.q1Channels.join(', ') }}
                    </p>
                 </div>
                 <div class="space-y-1">
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Recommandation (Q9)</p>
                    <p class="text-sm font-medium text-gray-900">{{ getLabel('q9Recommend', selectedSurvey()!.q9Recommend) }}</p>
                 </div>
                 <div class="space-y-1">
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">Ce qui a plu (Q6)</p>
                    <div class="flex flex-wrap gap-1">
                        @for (item of selectedSurvey()!.q6Liked; track item) {
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">{{ getLabel('q6Liked', item) }}</span>
                        }
                    </div>
                 </div>
                 <div class="space-y-1">
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wider">À améliorer (Q7)</p>
                    <div class="flex flex-wrap gap-1">
                        @for (item of selectedSurvey()!.q7Improvements; track item) {
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">{{ getLabel('q7Improvements', item) }}</span>
                        }
                    </div>
                 </div>
                 
                 @if (selectedSurvey()!.q13Comment) {
                   <div class="md:col-span-2 mt-4 pt-4 border-t border-gray-100">
                      <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Commentaire (Q13)</p>
                      <p class="text-sm text-gray-800 bg-blue-50 p-4 rounded-lg leading-relaxed italic border border-blue-100">
                        "{{ selectedSurvey()!.q13Comment }}"
                      </p>
                   </div>
                 }
              </div>
            </div>
          </div>
        </div>
      }
    </div>
